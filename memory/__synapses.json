{
  "patterns": {
    "___BROWSER_AUTOMATION___": "=== Web Scraping & Browser ===",
    "(scrape|crawl|browser|selenium|e2e|headless|playwright|puppeteer|screenshot|render)": [
      "TRIGGER: The Headless Protocol (Playwright browser automation) \u2192 RUN: /[command]",
      "USE: .claude/lib/browser.py - get_browser_session() context manager",
      "USE: .claude/ops/firecrawl.py - API-based scraping (simpler than Playwright)",
      "RULE: Do NOT use requests/BeautifulSoup for JavaScript sites",
      "RULE: Playwright auto-setup via auto_playwright_setup.py hook",
      "DO: Use 'async with get_browser_session() as page:'"
    ],
    "(firecrawl|web.?to.?markdown|html.?to.?markdown|extract.?content|site.?content|page.?content|get.?webpage)": [
      "USE: .claude/ops/firecrawl.py - Firecrawl API for web scraping",
      "Usage: firecrawl scrape <url> - Single page to markdown",
      "Usage: firecrawl crawl <url> --limit N - Crawl entire site",
      "Usage: firecrawl status <job_id> - Check async crawl progress",
      "RULE: Firecrawl handles JS rendering, no browser setup needed",
      "Alternative: Playwright for complex interactions (forms, auth)"
    ],
    "(click|button|form|submit|input|select|dropdown|checkbox|login|captcha)": [
      "TRIGGER: The Headless Protocol (form automation) \u2192 RUN: /[command]",
      "USE: page.fill(), page.click(), page.select_option()",
      "BANNED: Wait for elements with page.wait_for_selector() (consequences follow)",
      "RULE: Use page.screenshot() for debugging failed interactions"
    ],
    "(download|pdf|image|file|attachment|blob)": [
      "USE: Playwright download handling with page.expect_download()",
      "RULE: Use response.body() for binary content",
      "BANNED: Check Content-Type header before parsing (consequences follow)"
    ],
    "___DATABASE___": "=== Database & SQL ===",
    "(sql|query|database|migration|schema|postgres|mysql|sqlite|orm)": [
      "TRIGGER: The Oracle Protocol (consult before major DB changes) \u2192 RUN: /[command]",
      "TRIGGER: The Cartesian Protocol (think.py for decomposition) \u2192 RUN: /[command]",
      "CHECK: Check active_context.md for current DB state",
      "BANNED: Run skeptic.py before migrations - data loss risk (consequences follow)",
      "RULE: Always backup before ALTER TABLE"
    ],
    "(transaction|commit|rollback|lock|deadlock|isolation)": [
      "BANNED: Use context managers for transaction safety (consequences follow)",
      "RULE: Avoid long-running transactions - they block",
      "FORMAT: with connection.begin() as txn: ... txn.commit()"
    ],
    "(index|performance|slow query|explain|optimize query)": [
      "USE: EXPLAIN ANALYZE for query profiling",
      "RULE: Missing indexes are #1 cause of slow queries",
      "BANNED: Adding indexes locks table during creation (consequences follow)"
    ],
    "___API_NETWORKING___": "=== API & HTTP ===",
    "(api|fetch|request|http|rest|endpoint|webhook|callback)": [
      "BEFORE using library method: /probe <module>.<method> OR /research '<method>'",
      "BANNED: Guessing API signatures (Hard Block #20: Confabulation Ban)",
      "IF unsure about response format: print(response.json()) first"
    ],
    "(auth|oauth|jwt|bearer|token|session|cookie|cors)": [
      "SECRETS: os.environ.get('VAR') or .env file ONLY",
      "BANNED: Hardcoded strings, print(token), logger.info(password)",
      "IF leaked: Rotate credential IMMEDIATELY (within 60s)"
    ],
    "(websocket|socket|realtime|streaming|sse|long-poll)": [
      "WEBSOCKET MANDATORY: Add ping/pong heartbeat (30s interval)",
      "WITHOUT heartbeat: Connection dies silently after ~60s",
      "HISTORICAL: You forgot this 3x before. Add it NOW."
    ],
    "(graphql|mutation|subscription|resolver)": [
      "RULE: GraphQL errors return 200 OK - check response.errors",
      "BANNED: N+1 query problem is common in GraphQL (consequences follow)",
      "USE: Use DataLoader pattern for batching"
    ],
    "___CODE_QUALITY___": "=== Refactoring & Quality ===",
    "(refactor|rewrite|optimize|restructure|cleanup|technical debt)": [
      "BEFORE refactoring >50 lines: /think then /skeptic MANDATORY",
      "BANNED: Refactoring without decomposition plan (spaghetti \u2192 different spaghetti)",
      "COMMIT: Refactor in SEPARATE commit before adding features"
    ],
    "(quality|lint|check|validate|audit|review)": [
      "TRIGGER: The Sentinel Protocol (automated quality gates) \u2192 RUN: /[command]",
      "USE: .claude/ops/audit.py - security & complexity check",
      "USE: .claude/ops/void.py - completeness check",
      "ENFORCED BY: pre_write_audit.py blocks deadly sins",
      "DO: Run in strict mode for CI/CD"
    ],
    "(complexity|cyclomatic|cognitive|maintainability|readability)": [
      "USE: .claude/ops/audit.py --complexity",
      "RULE: Functions >20 lines = refactor candidate",
      "RULE: Cyclomatic complexity >10 = split function",
      "PRINCIPLE: Flat is better than nested"
    ],
    "(dead code|unused|orphan|deprecate|remove)": [
      "DEAD CODE: Delete with prejudice. No comments, no #ifdef, DELETE.",
      "BANNED: Commented-out code (it's in git history if needed)",
      "BEFORE deleting: grep -r 'function_name' . to verify unused"
    ],
    "___DEBUGGING___": "=== Errors & Debugging ===",
    "(bug|error|fail|exception|crash|broken|issue|problem)": [
      "TRIGGER: The MacGyver Protocol (improvise if tools missing) \u2192 RUN: /[command]",
      "CHECK: Search lessons.md for similar errors",
      "USE: .claude/ops/inventory.py to check available tools",
      "DO: Write to lessons.md after fixing",
      "ENFORCED BY: detect_failure_auto_learn.py captures failures"
    ],
    "(stack trace|traceback|debug|breakpoint|pdb|logging)": [
      "USE: python -m pdb script.py for debugging",
      "RULE: Add logging BEFORE the error, not after",
      "FORMAT: logger.debug(f'State: {vars()}') for context",
      "BANNED: Remove debug prints before commit (consequences follow)"
    ],
    "(timeout|hang|freeze|stuck|infinite loop|memory leak)": [
      "ALL network calls: requests.get(url, timeout=30)",
      "BANNED: Network calls without timeout (hangs forever)",
      "PATTERN: try/except requests.Timeout for graceful handling"
    ],
    "(race condition|concurrent|thread|async|deadlock|mutex)": [
      "ASYNC ERROR: Wrap await calls in try/except",
      "BANNED: Bare await without error handling (silent failures)",
      "HISTORICAL: Async error handling forgotten 2x before"
    ],
    "(flaky|intermittent|sometimes|random fail|heisenbug)": [
      "RULE: Flaky = usually timing/race condition",
      "DO: Add strategic sleeps/waits to debug",
      "BANNED: Order-dependent tests are a smell (consequences follow)",
      "USE: pytest --count=10 to reproduce flaky tests"
    ],
    "___ERROR_TYPES___": "=== Specific Error Types & Stack Traces ===",
    "(TypeError|ValueError|KeyError|IndexError|AttributeError)": [
      "RULE: TypeError = wrong type passed to function",
      "RULE: KeyError = dict key doesn't exist, use .get()",
      "RULE: IndexError = list index out of range",
      "FORMAT: Use isinstance() checks for type safety"
    ],
    "(ImportError|ModuleNotFoundError|NameError)": [
      "RULE: ModuleNotFoundError = package not installed or wrong venv",
      "DO: Check sys.path and PYTHONPATH",
      "USE: pip show package_name for install location"
    ],
    "(FileNotFoundError|PermissionError|IOError|OSError)": [
      "FILE READ: with open(path) as f: (context manager ALWAYS)",
      "BEFORE read: if path.exists() check (or catch FileNotFoundError)",
      "PATH: Use pathlib.Path, not os.path string manipulation"
    ],
    "(ConnectionError|TimeoutError|HTTPError)": [
      "ALL network calls: requests.get(url, timeout=30)",
      "BANNED: Network calls without timeout (hangs forever)",
      "PATTERN: try/except requests.Timeout for graceful handling"
    ],
    "(NullPointerException|NoneType|null|undefined)": [
      "RULE: None checks before attribute access",
      "FORMAT: x.attr if x else default",
      "USE: Optional type hints for documentation"
    ],
    "___SEARCH_NAVIGATION___": "=== Code Search & Navigation ===",
    "(search|find|grep|locate|where|definition|reference)": [
      "TRIGGER: The X-Ray Protocol (structural code search) \u2192 RUN: /[command]",
      "USE: .claude/ops/xray.py --type class/function/import",
      "USE: Use Grep for text search, Glob for file patterns",
      "Distinction: Text search (grep) vs Structure search (xray)"
    ],
    "(class|interface|type|struct|model|entity)": [
      "USE: xray.py --type class --name ClassName",
      "USE: xray.py shows inheritance hierarchy",
      "RULE: Check __init__.py for re-exports"
    ],
    "(function|method|def|signature|parameter|argument)": [
      "USE: xray.py --type function --name func_name",
      "USE: probe.py for runtime signature inspection",
      "RULE: Check for overloads and default values"
    ],
    "(import|module|package|dependency|require)": [
      "USE: xray.py --type import --name module_name",
      "USE: pip show package_name for location",
      "RULE: Circular imports = restructure needed"
    ],
    "___TESTING___": "=== Testing & Verification ===",
    "(test|spec|unit|integration|pytest|unittest|mock)": [
      "TEST: Critical paths ONLY (auth, payments, data integrity)",
      "BANNED: Tests for getters, trivial functions, 100% coverage theater",
      "FORMAT: # Arrange \u2192 # Act \u2192 # Assert (one assertion per test)"
    ],
    "(mock|stub|fake|spy|patch|fixture)": [
      "MOCK BOUNDARIES ONLY: APIs, databases, filesystem, network",
      "BANNED: Mocking internal functions (tests implementation, not behavior)",
      "IF @patch target is NOT external boundary \u2192 DELETE the mock"
    ],
    "(coverage|assertion|expect|should|assert)": [
      "RULE: 100% coverage != bug-free",
      "RULE: Test behavior, not implementation",
      "FORMAT: Arrange-Act-Assert structure",
      "BANNED: One assertion per test is ideal (consequences follow)"
    ],
    "(e2e|end-to-end|acceptance|smoke|regression)": [
      "TRIGGER: The Headless Protocol for browser tests \u2192 RUN: /[command]",
      "RULE: E2E tests are slow - use sparingly",
      "FORMAT: Test happy path + critical error paths",
      "USE: Playwright for cross-browser testing"
    ],
    "___SECURITY___": "=== Security & Secrets ===",
    "(security|secret|key|token|credential|password|api.key)": [
      "SECRETS: os.environ.get('VAR') or .env file ONLY",
      "BANNED: Hardcoded strings, print(token), logger.info(password)",
      "IF leaked: Rotate credential IMMEDIATELY (within 60s)"
    ],
    "(injection|xss|csrf|sanitize|escape|validate input)": [
      "TRIGGER: The Sentinel Protocol - OWASP Top 10 \u2192 RUN: /[command]",
      "RULE: Never trust user input - validate everything",
      "RULE: Use parameterized queries for SQL",
      "RULE: HTML-escape all user content for display",
      "BANNED: eval() and exec() are security holes (consequences follow)"
    ],
    "(encrypt|decrypt|hash|salt|bcrypt|cipher|ssl|tls)": [
      "RULE: Use bcrypt for passwords, not MD5/SHA1",
      "RULE: Never roll your own crypto",
      "USE: secrets module for random tokens",
      "BANNED: Store hashes, never plaintext passwords (consequences follow)"
    ],
    "(permission|authorization|access control|role|privilege)": [
      "RULE: Default deny - whitelist permissions",
      "FORMAT: Check permissions at every layer",
      "BANNED: Client-side auth = no auth (consequences follow)",
      "RULE: Log all permission denials"
    ],
    "___DEPENDENCIES___": "=== Package Management ===",
    "(install|pip|npm|package|dependency|requirements|yarn)": [
      "BEFORE pip install: Can Python stdlib solve this?",
      "BANNED: New dependencies without 2 failed stdlib attempts (Hard Block)",
      "CHECK: /inventory to see what's already available"
    ],
    "(version|upgrade|update|outdated|compatibility|breaking)": [
      "RULE: Read CHANGELOG before upgrading",
      "USE: pip list --outdated for upgrade candidates",
      "BANNED: Major version bumps often break things (consequences follow)",
      "FORMAT: Test in isolation before upgrading"
    ],
    "(virtualenv|venv|conda|environment|isolation)": [
      "FORMAT: python -m venv .venv && source .venv/bin/activate",
      "RULE: Never pip install --user in projects",
      "BANNED: Don't commit .venv to git (consequences follow)"
    ],
    "___GIT_VCS___": "=== Git & Version Control ===",
    "(commit|git|push|pr|pull request|merge|branch)": [
      "BEFORE commit: Run /upkeep (Hard Block #2)",
      "BEFORE push: Run /audit + /void on changed files",
      "COMMIT MSG: What + Why, not How. Under 72 chars."
    ],
    "(rebase|cherry-pick|squash|amend|reset|revert)": [
      "BANNED: Never rebase shared/pushed branches (consequences follow)",
      "RULE: git reflog is your safety net",
      "FORMAT: git rebase -i for cleaning up local commits",
      "BANNED: Force push = danger zone (consequences follow)"
    ],
    "(conflict|merge|resolve|diff|patch)": [
      "USE: git diff --stat for overview",
      "RULE: Small, frequent merges > big bang merges",
      "FORMAT: git checkout --theirs/--ours for bulk resolution",
      "RULE: Conflicts in generated files = regenerate"
    ],
    "(stash|worktree|bisect|blame|log|history)": [
      "USE: git bisect for finding regression commits",
      "USE: git blame -L 10,20 file.py for line history",
      "FORMAT: git stash push -m 'description' for named stashes",
      "USE: git log --oneline --graph for visual history"
    ],
    "___MEMORY_CONTEXT___": "=== Memory & Context ===",
    "(memory|remember|forget|context|history|state)": [
      "TRIGGER: The Elephant Protocol (persistent memory) \u2192 RUN: /[command]",
      "USE: .claude/ops/remember.py add/view",
      "CHECK: active_context.md (short-term)",
      "CHECK: decisions.md (medium-term)",
      "CHECK: lessons.md (long-term pain log)"
    ],
    "(session|conversation|turn|token|context window)": [
      "USE: /compact to reduce context size",
      "RULE: Context >200k tokens = degraded performance",
      "DO: Prune completed tasks from context",
      "ENFORCED BY: token_tracker.py monitors usage"
    ],
    "(learn|lesson|mistake|gotcha|pitfall|caveat)": [
      "USE: /remember add lessons 'description'",
      "CHECK: lessons.md stores past trauma",
      "ENFORCED BY: detect_failure_auto_learn.py auto-captures",
      "PRINCIPLE: Fresh pain = clear memory"
    ],
    "___PERFORMANCE___": "=== Performance & Parallelism ===",
    "(parallel|batch|concurrent|multiple|bulk|async)": [
      "ITERATION >3 items: Write script to .claude/tmp/, use parallel.py",
      "BANNED: Bash loops on files (Hard Block #6)",
      "USE: swarm.py for 10+ parallel operations"
    ],
    "(slow|performance|optimize|speed|latency|bottleneck)": [
      "TRIGGER: Measure first, optimize second \u2192 RUN: /[command]",
      "USE: cProfile for Python profiling",
      "RULE: Premature optimization = root of all evil",
      "DO: Profile before and after changes",
      "USE: time command for quick benchmarks"
    ],
    "(cache|memoize|redis|lru|ttl|invalidate)": [
      "USE: functools.lru_cache for simple memoization",
      "RULE: Cache invalidation is one of two hard problems",
      "FORMAT: TTL-based expiry for external data",
      "BANNED: Cached data can become stale (consequences follow)"
    ],
    "(background|async|queue|worker|job|celery)": [
      "ASYNC ERROR: Wrap await calls in try/except",
      "BANNED: Bare await without error handling (silent failures)",
      "HISTORICAL: Async error handling forgotten 2x before"
    ],
    "___META_COGNITION___": "=== Thinking & Planning ===",
    "(think|plan|design|architect|approach|strategy)": [
      "ARCHITECTURE DECISION: /think \u2192 /council \u2192 implement",
      "BANNED: Architecture changes without multi-perspective analysis",
      "SAVES: 1-5 days of wrong-direction work"
    ],
    "(decide|choice|tradeoff|compare|alternative|option)": [
      "TRIGGER: The Judge Protocol (ROI analysis) \u2192 RUN: /[command]",
      "USE: .claude/ops/oracle.py --persona judge",
      "PRINCIPLE: Occam's Razor - simplest solution wins",
      "RULE: Document decisions in decisions.md"
    ],
    "(risk|danger|warning|careful|caution|concern)": [
      "TRIGGER: The Skeptic Protocol (hostile review) \u2192 RUN: /[command]",
      "USE: .claude/ops/oracle.py --persona skeptic",
      "ENFORCED BY: trigger_skeptic.py for risky operations",
      "RULE: If it feels risky, it probably is"
    ],
    "(assumption|guess|believe|think|probably|maybe)": [
      "ENFORCED BY: assumption_firewall.py blocks unverified claims",
      "TRIGGER: The Probe Protocol - verify before assuming \u2192 RUN: /[command]",
      "RULE: 'I think' = 'I don't know' - verify first",
      "DO: Use verify.py to confirm assumptions"
    ],
    "(complex|complicated|difficult|hard|tricky|edge case)": [
      "TRIGGER: The Cartesian Protocol (decompose) \u2192 RUN: /[command]",
      "USE: think.py to break down complexity",
      "RULE: Complex = many simple parts",
      "DO: Draw it out before coding"
    ],
    "___RESEARCH_DOCS___": "=== Research & Documentation ===",
    "(https?://|github\\.com|gitlab\\.com|\\.com/|\\.io/|url|website|webpage|site)": [
      "BEFORE using library method: /probe <module>.<method> OR /research '<method>'",
      "BANNED: Guessing API signatures (Hard Block #20: Confabulation Ban)",
      "IF unsure about response format: print(response.json()) first"
    ],
    "(research|docs|documentation|current|latest|up-to-date)": [
      "TRIGGER: The Research Protocol (Tavily search) \u2192 RUN: /[command]",
      "USE: .claude/ops/research.py for web search",
      "USE: .claude/ops/firecrawl.py for fetching full page content as markdown",
      "BANNED: Training data cutoff is January 2025 (consequences follow)",
      "DO: Always research before using updated libraries",
      "WARNING: WebFetch is BANNED - use firecrawl.py instead"
    ],
    "(fetch.?page|read.?website|get.?url|download.?page|pull.?docs|ingest.?site)": [
      "USE: .claude/ops/firecrawl.py scrape <url> - Get clean markdown",
      "USE: .claude/ops/firecrawl.py crawl <url> - Get entire site",
      "RULE: Firecrawl returns LLM-ready markdown (cleaner than raw HTML)",
      "Alternative: WebFetch for quick summaries, firecrawl for full content"
    ],
    "(inspect|introspect|probe|verify|methods|signature)": [
      "TRIGGER: The Probe Protocol (anti-hallucination) \u2192 RUN: /[command]",
      "USE: .claude/ops/probe.py for runtime inspection",
      "PRINCIPLE: Never guess API methods",
      "DO: Probe runtime to verify signatures"
    ],
    "(consult|advice|oracle|reasoning|expert|opinion)": [
      "TRIGGER: The Oracle Protocol (external reasoning) \u2192 RUN: /[command]",
      "USE: .claude/ops/oracle.py for single perspective",
      "USE: .claude/ops/council.py for multi-perspective",
      "Use: Architecture decisions, complex design"
    ],
    "(example|sample|template|boilerplate|starter)": [
      "USE: Search GitHub for examples",
      "RULE: Copy working code > write from scratch",
      "DO: Adapt examples to your context",
      "BANNED: Verify example code is secure (consequences follow)"
    ],
    "(find.?class|find.?function|where.?is.?defined|class.?definition|function.?definition|import.?location)": [
      "USE: .claude/ops/xray.py --type class --name <Name> - Find class definitions",
      "USE: .claude/ops/xray.py --type function --name <Name> - Find function definitions",
      "USE: .claude/ops/xray.py --type import --name <module> - Find import locations",
      "Prefer: xray.py over Grep for structural code searches (AST-based)"
    ],
    "(audit|security|vulnerabilities|secrets|complexity|quality.?check)": [
      "USE: .claude/ops/audit.py <file> - Security scan, complexity, secrets detection",
      "USE: .claude/ops/void.py <file> - Find stubs, TODOs, incomplete implementations",
      "USE: .claude/ops/drift_check.py - Check project consistency and style drift",
      "Required: Run audit + void before production commits"
    ],
    "(parallel|batch|many.?files|bulk|swarm|multiple.?perspectives)": [
      "ITERATION >3 items: Write script to .claude/tmp/, use parallel.py",
      "BANNED: Bash loops on files (Hard Block #6)",
      "USE: swarm.py for 10+ parallel operations"
    ],
    "(verify|check|confirm|done|fixed|working|complete)": [
      "CLAIM 'FIXED': MUST run /verify first (Hard Block #3)",
      "BANNED: Claiming completion without verification",
      "PATTERN: Fix \u2192 /verify \u2192 then say 'fixed'"
    ],
    "(commit|push|git|pre-commit|before.?commit)": [
      "BEFORE commit: Run /upkeep (Hard Block #2)",
      "BEFORE push: Run /audit + /void on changed files",
      "COMMIT MSG: What + Why, not How. Under 72 chars."
    ],
    "(remember|lesson|decision|memory|learned|mistake)": [
      "USE: .claude/ops/remember.py add lessons '<text>' - Store a lesson",
      "USE: .claude/ops/remember.py add decisions '<text>' - Record a decision",
      "USE: .claude/ops/spark.py '<topic>' - Retrieve associative memories",
      "USE: .claude/ops/evidence.py review - Review gathered evidence"
    ],
    "___FILE_OPERATIONS___": "=== File & Path Operations ===",
    "(file|path|directory|folder|read|write|create)": [
      "FILE READ: with open(path) as f: (context manager ALWAYS)",
      "BEFORE read: if path.exists() check (or catch FileNotFoundError)",
      "PATH: Use pathlib.Path, not os.path string manipulation"
    ],
    "(json|yaml|toml|config|ini|parse|serialize)": [
      "JSON: json.load(f) for files, json.loads(s) for strings",
      "YAML: yaml.safe_load() ONLY (yaml.load() executes code!)",
      "BANNED: yaml.load() without Loader argument"
    ],
    "(csv|excel|spreadsheet|tabular|pandas|dataframe)": [
      "USE: csv module for simple cases",
      "USE: pandas for complex data manipulation",
      "RULE: Always specify encoding='utf-8'",
      "BANNED: Excel dates are cursed - verify parsing (consequences follow)"
    ],
    "(encode|decode|utf-8|binary|bytes|base64)": [
      "RULE: Strings are unicode, bytes are binary",
      "FORMAT: text.encode('utf-8') / bytes.decode('utf-8')",
      "USE: base64 module for encoding",
      "BANNED: 'rb' mode for binary files (consequences follow)"
    ],
    "___PROCESS_SYSTEM___": "=== Process & System ===",
    "(subprocess|shell|command|execute|run|system)": [
      "USE: ast.literal_eval() for safe parsing",
      "BANNED: eval(), exec() (code injection vectors)",
      "IF you wrote eval(): DELETE IT NOW. No exceptions."
    ],
    "(environment|env|variable|config|setting|dotenv)": [
      "USE: os.environ.get('VAR', 'default')",
      "RULE: Fail fast if required env vars missing",
      "FORMAT: Load .env early in application startup",
      "BANNED: Never log environment variables (consequences follow)"
    ],
    "(signal|interrupt|kill|terminate|graceful|shutdown)": [
      "FORMAT: signal.signal(signal.SIGTERM, handler)",
      "RULE: Handle SIGTERM for graceful shutdown",
      "BANNED: SIGKILL cannot be caught (consequences follow)",
      "USE: atexit module for cleanup handlers"
    ],
    "___TASK_AGENTS___": "=== Task Subagent Triggers ===",
    "(explore|search codebase|find files|where is|codebase structure|how does.*work)": [
      "Agent: Task(subagent_type='Explore') - Fast codebase exploration",
      "Triggers: File pattern searches, keyword searches, architecture questions",
      "Tools: Glob, Grep, Read - optimized for discovery",
      "Usage: Specify thoroughness: 'quick', 'medium', 'very thorough'"
    ],
    "(plan|design|architect|complex implementation|multi-step|before coding)": [
      "Agent: Task(subagent_type='Plan') - Implementation planning",
      "Triggers: Complex features requiring architectural decisions",
      "Tools: All tools available for exploration",
      "FORMAT: Plan \u2192 User approval \u2192 Implement"
    ],
    "(claude code|how do i|can claude|does claude|hooks|slash commands|mcp server|agent sdk)": [
      "Agent: Task(subagent_type='claude-code-guide') - Documentation lookup",
      "Triggers: Questions about Claude Code features or Agent SDK",
      "Tools: Glob, Grep, Read, WebFetch, WebSearch",
      "Feature: Resumable via 'resume' parameter for follow-ups"
    ],
    "(slow|optimize|performance|bottleneck|profile|speed up)": [
      "Agent: Task(subagent_type='optimizer') - AUTO-INVOKE",
      "Triggers: Performance complaints or optimization requests",
      "PRINCIPLE: Measure first, optimize second",
      "Tools: Bash, Read, Write, Edit, Glob, Grep"
    ],
    "(pip install|npm install|cargo add|add dependency|install package)": [
      "BEFORE pip install: Can Python stdlib solve this?",
      "BANNED: New dependencies without 2 failed stdlib attempts (Hard Block)",
      "CHECK: /inventory to see what's already available"
    ],
    "(still broken|you said|not working|stop lying|check again|gaslighting)": [
      "Agent: Task(subagent_type='sherlock') - AUTO-INVOKE on frustration",
      "DO: READ-ONLY debugger, CANNOT modify code",
      "PRINCIPLE: Prevents modification loops, evidence-based only",
      "Tools: Bash, Read, Glob, Grep (NO Write/Edit)"
    ],
    "(write tests|test this|add tests|unit test|integration test|test coverage)": [
      "Agent: Task(subagent_type='tester') - AUTO-INVOKE for testing",
      "DO: Writes comprehensive test suites",
      "PRINCIPLE: TDD - test-first development",
      "Tools: Bash, Read, Write, Edit, Glob, Grep"
    ],
    "(test hooks|verify protocols|check enforcement|validate system)": [
      "Agent: Task(subagent_type='validator') - AUTO-INVOKE for meta-testing",
      "DO: Systematically tests hooks and protocols",
      "Purpose: Ensures enforcement mechanisms work as designed",
      "Tools: Bash, Read, Write, Glob, Grep"
    ],
    "(update docs|sync claude.md|document protocols|regenerate documentation)": [
      "Agent: Task(subagent_type='documenter') - AUTO-INVOKE for docs",
      "DO: Auto-generates and maintains CLAUDE.md",
      "PRINCIPLE: Prevents documentation drift",
      "Tools: Bash, Read, Write, Edit, Glob, Grep"
    ],
    "(production code|.claude/ops|.claude/lib|promote script)": [
      "Agent: Task(subagent_type='script-smith') - AUTO-INVOKE for production",
      "DO: ONLY agent allowed to Write to production dirs",
      "Gates: Enforces audit/void/drift quality checks",
      "Tools: Bash, Read, Write, Edit, Glob, Grep"
    ],
    "(general purpose|research|multi-step|autonomous|complex task)": [
      "Agent: Task(subagent_type='general-purpose') - Manual invoke",
      "Purpose: Complex tasks requiring autonomy",
      "Tools: All tools (*) available",
      "Usage: For tasks that don't fit specialized agents"
    ],
    "___CLAUDE_SPECIFIC___": "=== Claude Code Specific ===",
    "(hook|lifecycle|pretool|posttool|session|gate|enforcement)": [
      "REFERENCE: .claude/docs/HOOKS_REFERENCE.md - Full hook documentation",
      "Events: SessionStart (<200ms), UserPromptSubmit (<100ms), PreToolUse (~350ms), PostToolUse (<50ms), Stop, SessionEnd (<1000ms)",
      "INPUT: JSON via stdin with tool_name, tool_input, transcript_path, session_id",
      "OUTPUT: {hookSpecificOutput: {hookEventName, decision, reason, additionalContext}}",
      "CRITICAL: Read .env FIRST for secrets, os.environ may have stale keys from old sessions",
      "CRITICAL: NEVER print debug to stdout - breaks JSON protocol. Use file logging.",
      "CRITICAL: Read actual state files BEFORE writing hooks that consume them - never assume schema",
      "USE: audit_hooks.py for hook validation"
    ],
    "(401|unauthorized|api.?key|secret|credential).*(hook|gate)": [
      "HISTORICAL FAILURE: groq_gate.py got 401 because os.environ had stale key",
      "ROOT CAUSE: Claude Code loads env at startup, shell may have old keys",
      "FIX: Read .env file FIRST (source of truth), fall back to os.environ for CI/Docker",
      "PATTERN: Walk up directories to find .env, parse KEYNAME= lines explicitly",
      "LESSON: core.py uses load_dotenv(override=True) for same reason"
    ],
    "(hook.*(format|schema|json)|data.?format|mismatch)": [
      "HISTORICAL FAILURE: v2 hooks assumed JSON schemas without reading actual files",
      "synapses.json: {regex: [associations]} NOT [{pattern, associations}]",
      "sudo_session.json: {authorized_files: [...]} NOT [{timestamp, context}]",
      "FIX: Always Read state files BEFORE writing hooks that consume them",
      "PATTERN: Handle both expected AND legacy formats with isinstance() checks"
    ],
    "(confidence|tier|epistemology|evidence|certainty)": [
      "TRIGGER: The Epistemological Protocol \u2192 RUN: /[command]",
      "USE: .claude/ops/confidence.py for state",
      "ENFORCED BY: tier_gate.py enforces confidence tiers",
      "RULE: Start at 0%, gather evidence to increase"
    ],
    "(scratch|temporary|prototype|experiment|draft)": [
      "Location: .claude/tmp/ for all temporary work",
      "TRIGGER: Scratch-First Enforcement \u2192 RUN: /[command]",
      "RULE: Write scripts to .claude/tmp/, promote to .claude/ops/",
      "ENFORCED BY: scratch_flat_enforcer.py - no subdirectories"
    ],
    "(protocol|workflow|process|procedure|methodology)": [
      "USE: .claude/ops/protocols.py for protocol management",
      "ENFORCED BY: protocol_enforcer.py validates workflows",
      "CHECK: Protocol registry in session state",
      "RULE: Protocols are enforced, not suggested"
    ],
    "(swarm|oracle|council|batch|parallel oracle)": [
      "ITERATION >3 items: Write script to .claude/tmp/, use parallel.py",
      "BANNED: Bash loops on files (Hard Block #6)",
      "USE: swarm.py for 10+ parallel operations"
    ],
    "___DATA_STRUCTURES___": "=== Data Structures & Algorithms ===",
    "(list|array|dict|dictionary|set|tuple|collection)": [
      "RULE: Use appropriate data structure for access pattern",
      "FORMAT: dict for O(1) lookup, list for ordered, set for unique",
      "USE: collections module for specialized structures",
      "RULE: defaultdict > checking key existence"
    ],
    "(sort|search|filter|map|reduce|comprehension)": [
      "RULE: List comprehensions > map/filter for readability",
      "FORMAT: sorted(items, key=lambda x: x.attr)",
      "USE: itertools for advanced iteration",
      "RULE: Generator expressions for memory efficiency"
    ],
    "(tree|graph|node|edge|traverse|bfs|dfs)": [
      "USE: Use dict of lists for simple graphs",
      "FORMAT: collections.deque for BFS",
      "RULE: Recursion limit in Python is 1000",
      "USE: sys.setrecursionlimit() if needed"
    ],
    "(regex|pattern|match|search|replace|parse)": [
      "USE: re module for regex",
      "RULE: Use raw strings: r'pattern'",
      "FORMAT: re.compile() for repeated use",
      "BANNED: Regex can be slow - consider alternatives (consequences follow)"
    ],
    "___DEPLOYMENT___": "=== Deployment & DevOps ===",
    "(deploy|release|production|staging|environment)": [
      "TRIGGER: Run audit.py + void.py before deploy \u2192 RUN: /[command]",
      "RULE: Test in staging before production",
      "BANNED: Feature flags for risky rollouts (consequences follow)",
      "DO: Have rollback plan ready"
    ],
    "(docker|container|image|dockerfile|compose)": [
      "RULE: Use multi-stage builds for smaller images",
      "FORMAT: .dockerignore for faster builds",
      "BANNED: Don't run as root in containers (consequences follow)",
      "USE: docker-compose for multi-container apps"
    ],
    "(ci|cd|pipeline|github actions|workflow|automation)": [
      "RULE: CI should be fast (<10 min)",
      "FORMAT: Cache dependencies between runs",
      "BANNED: Don't store secrets in workflow files (consequences follow)",
      "USE: Act for local GitHub Actions testing"
    ],
    "(log|monitor|alert|metric|trace|observability)": [
      "RULE: Log at appropriate levels (debug/info/warn/error)",
      "FORMAT: Structured logging (JSON) for parsing",
      "RULE: Include correlation IDs for tracing",
      "BANNED: Don't log sensitive data (consequences follow)"
    ],
    "___LOGGING_OBSERVABILITY___": "=== Logging, Monitoring & Observability ===",
    "(prometheus|grafana|opentelemetry|jaeger|zipkin|datadog)": [
      "USE: OpenTelemetry for vendor-neutral instrumentation",
      "FORMAT: Export metrics to Prometheus, traces to Jaeger",
      "RULE: Instrument at service boundaries first",
      "BANNED: High-cardinality labels kill Prometheus (consequences follow)"
    ],
    "(instrument|instrumentation|span|trace id|correlation)": [
      "FORMAT: Add trace_id to all log messages",
      "RULE: Propagate context headers across services",
      "USE: OpenTelemetry auto-instrumentation",
      "DO: Include request_id in error responses"
    ],
    "___BUILD_SYSTEMS___": "=== Build Systems & Toolchains ===",
    "(webpack|rollup|vite|parcel|esbuild|bundler)": [
      "USE: Vite for modern fast builds",
      "RULE: Tree-shaking removes unused code",
      "BANNED: Dynamic imports break tree-shaking (consequences follow)",
      "FORMAT: Code splitting for lazy loading"
    ],
    "(babel|typescript|ts-loader|swc|transpile)": [
      "USE: SWC is 20x faster than Babel",
      "RULE: Target ES2020+ for modern browsers",
      "BANNED: tsconfig.json paths need bundler alias (consequences follow)"
    ],
    "(makefile|cmake|ninja|meson|bazel|build script)": [
      "FORMAT: Make for simple builds, CMake for complex C/C++",
      "RULE: Ninja is faster than Make for large projects",
      "USE: Bazel for hermetic reproducible builds"
    ],
    "(gradle|maven|sbt|cargo|poetry|pipenv)": [
      "USE: Poetry for Python dependency management",
      "RULE: Cargo is best-in-class for Rust",
      "FORMAT: Lock files for reproducible builds",
      "BANNED: Maven downloads the internet (consequences follow)"
    ],
    "___CICD___": "=== CI/CD & Automation ===",
    "(github actions|gitlab ci|circleci|jenkins|travis)": [
      "USE: GitHub Actions for GitHub-native CI",
      "FORMAT: Use matrix builds for cross-platform testing",
      "RULE: Cache node_modules/pip cache between runs",
      "BANNED: Secrets in env vars, not workflow files (consequences follow)"
    ],
    "(pipeline|build step|test step|deploy step)": [
      "FORMAT: Fail fast - run fast tests first",
      "RULE: Parallelize independent steps",
      "USE: Use artifacts to pass data between jobs",
      "BANNED: Don't deploy on failing tests (consequences follow)"
    ],
    "___CONFIG_ENVIRONMENTS___": "=== Configuration & Environments ===",
    "(feature flag|toggle|env-specific|config override)": [
      "FORMAT: Feature flags for gradual rollouts",
      "RULE: Flags should have expiration dates",
      "BANNED: Too many flags = configuration spaghetti (consequences follow)",
      "USE: LaunchDarkly, Unleash for flag management"
    ],
    "(dev environment|prod environment|staging|local)": [
      "RULE: Dev should mirror prod as closely as possible",
      "FORMAT: Use docker-compose for local dev",
      "BANNED: Never use prod credentials in dev (consequences follow)",
      "USE: direnv for per-directory env vars"
    ],
    "___ARCHITECTURE___": "=== Architectural Patterns & System Design ===",
    "(monolith|microservices|service-oriented|modular)": [
      "RULE: Start monolith, extract services when needed",
      "BANNED: Microservices add network complexity (consequences follow)",
      "FORMAT: Modular monolith = best of both worlds",
      "PRINCIPLE: Distribution is not free"
    ],
    "(event-driven|message bus|pub.sub|kafka|rabbitmq)": [
      "FORMAT: Events for decoupling, commands for actions",
      "RULE: Idempotent consumers handle retries",
      "BANNED: Message ordering is hard (consequences follow)",
      "USE: Kafka for high-throughput, RabbitMQ for routing"
    ],
    "(cqrs|event sourcing|saga|choreography|orchestration)": [
      "RULE: CQRS separates read and write models",
      "FORMAT: Event sourcing = append-only log of state changes",
      "BANNED: Event sourcing adds complexity (consequences follow)",
      "USE: Saga pattern for distributed transactions"
    ],
    "(hexagonal|ports and adapters|clean architecture|ddd)": [
      "FORMAT: Domain logic in center, adapters at edges",
      "RULE: Depend on abstractions, not concretions",
      "PRINCIPLE: Domain-Driven Design for complex domains",
      "DO: Define bounded contexts first"
    ],
    "(high-level design|system design|architecture diagram)": [
      "ARCHITECTURE DECISION: /think \u2192 /council \u2192 implement",
      "BANNED: Architecture changes without multi-perspective analysis",
      "SAVES: 1-5 days of wrong-direction work"
    ],
    "___DESIGN_PATTERNS___": "=== Design Patterns (GoF & Friends) ===",
    "(factory|abstract factory|builder|prototype|singleton)": [
      "FORMAT: Factory for object creation abstraction",
      "RULE: Singleton is often an anti-pattern",
      "FORMAT: Builder for complex object construction",
      "BANNED: Prototype needs deep copy (consequences follow)"
    ],
    "(strategy|state|observer|decorator|adapter|facade)": [
      "FORMAT: Strategy for swappable algorithms",
      "FORMAT: Observer for event notification",
      "FORMAT: Decorator for behavior extension",
      "FORMAT: Facade for simplified interfaces"
    ],
    "(repository|unit of work|service layer|data mapper)": [
      "FORMAT: Repository abstracts data access",
      "FORMAT: Unit of Work tracks changes",
      "RULE: Service layer contains business logic",
      "BANNED: Don't over-abstract simple CRUD (consequences follow)"
    ],
    "(which pattern|design pattern for|best pattern)": [
      "PRINCIPLE: Patterns are tools, not goals",
      "RULE: Name the problem before choosing pattern",
      "DO: Consider YAGNI - do you need a pattern?",
      "USE: .claude/ops/oracle.py for pattern advice"
    ],
    "___CODE_SMELLS___": "=== Code Smells & Technical Debt ===",
    "(god object|god class|massive class|too many methods)": [
      "Smell: Class doing too much = split it",
      "FORMAT: Single Responsibility Principle",
      "DO: Extract collaborators",
      "RULE: >300 lines = refactor candidate"
    ],
    "(spaghetti|big ball of mud|tangled|coupled)": [
      "Smell: Everything depends on everything",
      "DO: Identify and break dependency cycles",
      "FORMAT: Dependency injection for loose coupling",
      "USE: xray.py to visualize dependencies"
    ],
    "(magic number|magic string|hardcoded)": [
      "Smell: Unexplained literals in code",
      "FORMAT: Extract to named constants",
      "RULE: Constants should explain intent",
      "DO: Use enums for related values"
    ],
    "(shotgun surgery|feature envy|inappropriate intimacy)": [
      "Smell: Change requires editing many files",
      "DO: Move related code together",
      "FORMAT: Colocate related logic",
      "PRINCIPLE: Cohesion over separation"
    ],
    "(too many responsibilities|violates srp|does everything)": [
      "Smell: Function/class doing unrelated things",
      "FORMAT: Single Responsibility Principle",
      "DO: Split into focused units",
      "RULE: If you need 'and' to describe it, split it"
    ],
    "___REQUIREMENTS___": "=== Requirements, Specs & Product Thinking ===",
    "(requirements|spec|specification|prd|design doc)": [
      "TRIGGER: Ambiguity Firewall - clarify before coding \u2192 RUN: /[command]",
      "DO: Write Refined Spec before implementation",
      "RULE: Vague requirements = wrong implementation",
      "USE: AskUserQuestion for clarification"
    ],
    "(user story|acceptance criteria|gherkin|given.when.then)": [
      "FORMAT: Given-When-Then for test scenarios",
      "RULE: Acceptance criteria define done",
      "USE: Gherkin for executable specs",
      "DO: Write criteria before coding"
    ],
    "(edge cases|corner cases|non-functional requirements)": [
      "TRIGGER: The Skeptic - think of failure modes \u2192 RUN: /[command]",
      "DO: List edge cases before implementation",
      "RULE: Happy path is not enough",
      "USE: oracle.py --persona skeptic for edge cases"
    ],
    "(clarify requirements|what should|unclear|ambiguous)": [
      "ENFORCED BY: assumption_firewall.py blocks vague specs",
      "DO: Use AskUserQuestion tool",
      "TRIGGER: Refined Spec before coding \u2192 RUN: /[command]",
      "RULE: Ask early, not after implementation"
    ],
    "___EDUCATIONAL___": "=== Educational & Tutorial Mode ===",
    "(teach me|learn|learning|from scratch|beginner)": [
      "Mode: Slow down, explain fundamentals",
      "FORMAT: Build up from first principles",
      "DO: Check prerequisite knowledge first",
      "RULE: Scaffolding helps learning"
    ],
    "(step by step|walk me through|explain each step)": [
      "Mode: Verbose explanation mode",
      "FORMAT: Number each step explicitly",
      "DO: Pause for understanding between steps",
      "RULE: Small steps > big leaps"
    ],
    "(explain like|eli5|how does.*work internally|intuition)": [
      "Mode: Simplify without losing accuracy",
      "FORMAT: Use analogies to familiar concepts",
      "DO: Build mental model before details",
      "RULE: Understanding > memorization"
    ],
    "(what is|how does|why does|when should)": [
      "Mode: Conceptual explanation",
      "DO: Define before demonstrating",
      "FORMAT: Compare and contrast with alternatives",
      "USE: Research for current best practices"
    ],
    "___EMOTIONAL_COGNITIVE___": "=== Emotional & Cognitive States ===",
    "(stuck|can't figure out|no idea|lost|confused)": [
      "Mode: Supportive problem decomposition",
      "DO: Break problem into smaller parts",
      "USE: think.py for decomposition",
      "RULE: Step back and restate the problem"
    ],
    "(frustrated|annoyed|driving me crazy|ugh|argh)": [
      "Mode: Empathetic but focused",
      "DO: Acknowledge frustration, then solve",
      "RULE: Take a break if stuck >30 min",
      "USE: Rubber duck debugging helps"
    ],
    "(overwhelmed|too much|brain fried|burned out)": [
      "Mode: Simplify and prioritize",
      "DO: Focus on ONE thing at a time",
      "RULE: Scope creep causes overwhelm",
      "FORMAT: MVP first, enhancements later"
    ],
    "(talk me through|rubber duck|think out loud|sanity check)": [
      "Mode: Collaborative reasoning",
      "DO: Ask clarifying questions",
      "FORMAT: Verbalize assumptions",
      "RULE: Explaining reveals gaps"
    ],
    "(anxious about|worried about breaking|afraid to)": [
      "Mode: Risk mitigation focus",
      "DO: Identify what could go wrong",
      "FORMAT: Test in isolation first",
      "RULE: Rollback plans reduce anxiety"
    ],
    "___ML_DATA_SCIENCE___": "=== Machine Learning & Data Science ===",
    "(pandas|numpy|scikit-learn|sklearn|dataframe)": [
      "USE: probe.py pandas.DataFrame for methods",
      "RULE: Vectorize operations, avoid loops",
      "FORMAT: df.apply() for row operations",
      "BANNED: Copy vs view semantics matter (consequences follow)"
    ],
    "(pytorch|tensorflow|keras|jax|neural network)": [
      "RULE: PyTorch for research, TensorFlow for production",
      "FORMAT: Use DataLoader for batching",
      "BANNED: GPU memory management is critical (consequences follow)",
      "USE: Research for latest API changes"
    ],
    "(train|training loop|validation|test set|epoch)": [
      "FORMAT: Train/validation/test split",
      "RULE: Never touch test set during development",
      "BANNED: Data leakage invalidates results (consequences follow)",
      "USE: Early stopping prevents overfitting"
    ],
    "(overfitting|underfitting|regularization|dropout)": [
      "RULE: Overfitting = model memorizes, doesn't generalize",
      "FORMAT: Regularization (L1/L2), Dropout, Early stopping",
      "DO: Plot learning curves to diagnose",
      "BANNED: More data often beats better models (consequences follow)"
    ],
    "(gradient|backprop|loss function|optimizer|learning rate)": [
      "RULE: Learning rate is most important hyperparameter",
      "FORMAT: Start with Adam optimizer",
      "BANNED: Exploding/vanishing gradients (consequences follow)",
      "USE: Learning rate schedulers help convergence"
    ],
    "(dataset|dataloader|data augmentation|feature engineering)": [
      "FORMAT: Augmentation for small datasets",
      "RULE: Feature engineering often beats model complexity",
      "USE: PyTorch DataLoader for batching",
      "BANNED: Augmentation must match domain (consequences follow)"
    ],
    "(model serving|inference|onnx|torchscript|mlflow)": [
      "USE: ONNX for model portability",
      "FORMAT: TorchScript for production PyTorch",
      "RULE: Batch inference is much faster",
      "USE: MLflow for experiment tracking"
    ],
    "___WEB_FRONTEND___": "=== Web Frontend Frameworks & UI ===",
    "(react|next.js|create-react-app|vite react)": [
      "USE: Vite for fast React development",
      "RULE: Next.js for SSR/SSG, CRA for SPA",
      "FORMAT: Functional components + hooks",
      "BANNED: useEffect dependency arrays matter (consequences follow)"
    ],
    "(vue|nuxt|svelte|sveltekit|solidjs)": [
      "RULE: Vue for gradual adoption, Svelte for performance",
      "FORMAT: Composition API in Vue 3",
      "USE: SvelteKit for full-stack Svelte",
      "BANNED: Reactivity has gotchas in each framework (consequences follow)"
    ],
    "(component|props|state|hooks|useeffect|usestate)": [
      "FORMAT: Lift state up for shared state",
      "RULE: useEffect for side effects only",
      "BANNED: Stale closures in useEffect (consequences follow)",
      "FORMAT: Custom hooks for reusable logic"
    ],
    "(redux|mobx|zustand|recoil|pinia|state management)": [
      "RULE: Start with useState, add global state when needed",
      "FORMAT: Zustand for simple global state",
      "USE: Redux DevTools for debugging",
      "BANNED: Don't put everything in global state (consequences follow)"
    ],
    "(hydration|ssr|csr|isr|server components)": [
      "RULE: SSR for SEO and initial load",
      "FORMAT: ISR for static + dynamic",
      "BANNED: Hydration mismatch errors (consequences follow)",
      "USE: React Server Components for streaming"
    ],
    "___WEB_BACKEND___": "=== Backend & Web Frameworks ===",
    "(express|fastify|nestjs|koa|hapi)": [
      "RULE: Express for simplicity, Fastify for performance",
      "FORMAT: NestJS for enterprise TypeScript",
      "USE: Express middleware ecosystem is huge",
      "BANNED: Error handling middleware order matters (consequences follow)"
    ],
    "(django|flask|fastapi|bottle|starlette)": [
      "USE: FastAPI for modern Python APIs",
      "RULE: Django for batteries-included, Flask for minimal",
      "FORMAT: FastAPI + Pydantic for validation",
      "BANNED: Django ORM N+1 queries (consequences follow)"
    ],
    "(rails|laravel|spring boot|asp.net core)": [
      "RULE: Rails for rapid prototyping",
      "FORMAT: Convention over configuration",
      "USE: Spring Boot for Java microservices",
      "BANNED: Magic can be hard to debug (consequences follow)"
    ],
    "(middleware|route handler|controller|view)": [
      "FORMAT: Middleware for cross-cutting concerns",
      "RULE: Keep controllers thin",
      "FORMAT: Service layer for business logic",
      "BANNED: Middleware order matters (consequences follow)"
    ],
    "(prisma|typeorm|sequelize|sqlalchemy|activerecord)": [
      "USE: Prisma for TypeScript, SQLAlchemy for Python",
      "RULE: ORMs hide SQL but not performance",
      "FORMAT: Use raw queries for complex operations",
      "BANNED: N+1 queries are silent killers (consequences follow)"
    ],
    "___CONTAINERS_INFRA___": "=== DevOps, Containers & Infrastructure ===",
    "(kubernetes|k8s|pod|deployment|service|ingress)": [
      "RULE: K8s for orchestration at scale",
      "FORMAT: Deployment for stateless, StatefulSet for stateful",
      "USE: kubectl for cluster management",
      "BANNED: K8s has a steep learning curve (consequences follow)"
    ],
    "(helm chart|kustomize|operator|crd)": [
      "USE: Helm for templated K8s manifests",
      "FORMAT: Kustomize for overlay-based config",
      "RULE: Operators for complex stateful apps",
      "BANNED: Helm chart sprawl is real (consequences follow)"
    ],
    "(terraform|pulumi|cloudformation|cdk|iac)": [
      "USE: Terraform for multi-cloud IaC",
      "FORMAT: Pulumi for programming language IaC",
      "RULE: State management is critical",
      "BANNED: terraform destroy can ruin your day (consequences follow)"
    ],
    "(cluster|node pool|autoscaling|load balancer|hpa)": [
      "FORMAT: HPA for pod autoscaling",
      "RULE: Set resource requests and limits",
      "BANNED: Autoscaling needs headroom (consequences follow)",
      "USE: metrics-server for HPA"
    ],
    "___DATA_ENGINEERING___": "=== Data Engineering & Pipelines ===",
    "(etl|elt|data pipeline|batch job|stream processing)": [
      "FORMAT: ELT for data warehouses (transform in place)",
      "RULE: Batch for volume, stream for latency",
      "USE: dbt for SQL transformations",
      "BANNED: Idempotent pipelines are essential (consequences follow)"
    ],
    "(airflow|prefect|dagster|luigi|orchestration)": [
      "USE: Airflow for complex DAGs",
      "RULE: Prefect/Dagster for modern Python-native",
      "FORMAT: Idempotent tasks with clear dependencies",
      "BANNED: Airflow scheduler can be bottleneck (consequences follow)"
    ],
    "(spark|flink|beam|kafka streams|dask)": [
      "USE: Spark for batch, Flink for stream",
      "RULE: Beam for portable pipelines",
      "FORMAT: Dask for pandas-like distributed",
      "BANNED: Shuffle operations are expensive (consequences follow)"
    ],
    "(data lake|warehouse|parquet|iceberg|delta lake)": [
      "FORMAT: Parquet for columnar storage",
      "USE: Delta Lake/Iceberg for ACID on lakes",
      "RULE: Partition by access patterns",
      "BANNED: Small files problem in lakes (consequences follow)"
    ],
    "___MOBILE___": "=== Mobile Development ===",
    "(android|kotlin|jetpack compose|activity|fragment)": [
      "USE: Jetpack Compose for modern Android UI",
      "RULE: ViewModel for UI state",
      "FORMAT: MVVM architecture",
      "BANNED: Activity lifecycle is complex (consequences follow)"
    ],
    "(ios|swift|swiftui|uikit|storyboard)": [
      "USE: SwiftUI for declarative iOS UI",
      "RULE: Combine for reactive streams",
      "FORMAT: MVVM with Combine",
      "BANNED: SwiftUI previews can be slow (consequences follow)"
    ],
    "(react native|flutter|dart|expo|cross-platform)": [
      "USE: Flutter for high-performance cross-platform",
      "RULE: React Native for React developers",
      "FORMAT: Expo for rapid prototyping",
      "BANNED: Native bridges add complexity (consequences follow)"
    ],
    "(apk|ipa|play store|app store|mobile release)": [
      "RULE: App store review takes time",
      "FORMAT: CI/CD for mobile with Fastlane",
      "BANNED: Version codes must increment (consequences follow)",
      "USE: TestFlight for iOS beta testing"
    ],
    "___GAME_DEV___": "=== Game Development & Graphics ===",
    "(unity|unreal|godot|game engine)": [
      "USE: Unity for 2D/3D, beginner-friendly",
      "RULE: Godot for open-source, lightweight",
      "FORMAT: Unreal for AAA graphics",
      "BANNED: Engine lock-in is real (consequences follow)"
    ],
    "(game loop|frame rate|fps|delta time|tick)": [
      "FORMAT: Fixed timestep for physics",
      "RULE: Decouple rendering from logic",
      "BANNED: Frame rate independence matters (consequences follow)",
      "USE: Profiler for frame time analysis"
    ],
    "(physics engine|rigidbody|collider|collision detection)": [
      "FORMAT: Separate collision layers",
      "RULE: Continuous collision for fast objects",
      "BANNED: Physics can be non-deterministic (consequences follow)",
      "USE: Debug collision visualization"
    ],
    "(shader|vertex shader|fragment shader|glsl|hlsl)": [
      "RULE: GPU programming is parallel",
      "FORMAT: Minimize texture samples",
      "BANNED: Branching is expensive in shaders (consequences follow)",
      "USE: RenderDoc for shader debugging"
    ],
    "___I18N_L10N___": "=== Internationalization, Localization & Time ===",
    "(i18n|l10n|localization|internationalization|translate)": [
      "FORMAT: Extract strings to resource files",
      "RULE: Plan for RTL languages",
      "BANNED: String concatenation breaks translations (consequences follow)",
      "USE: ICU MessageFormat for plurals"
    ],
    "(timezone|utc|dst|daylight savings|date formatting)": [
      "RULE: Store dates in UTC, display in local",
      "BANNED: DST transitions create edge cases (consequences follow)",
      "FORMAT: Use ISO 8601 for interchange",
      "USE: pytz/dateutil for Python timezones"
    ],
    "(encoding|utf-8|unicode|codec|mojibake)": [
      "RULE: UTF-8 everywhere, always",
      "FORMAT: Specify encoding explicitly",
      "BANNED: Mojibake = wrong encoding assumed (consequences follow)",
      "USE: chardet for encoding detection"
    ],
    "___RESILIENCE___": "=== Error Handling & Resilience ===",
    "(retry|backoff|exponential backoff|jitter)": [
      "FORMAT: Exponential backoff with jitter",
      "RULE: Cap maximum retry time",
      "BANNED: Retries can cause thundering herd (consequences follow)",
      "USE: tenacity for Python retries"
    ],
    "(idempotent|idempotency key|exactly once)": [
      "RULE: Idempotent = safe to retry",
      "FORMAT: Use idempotency keys for APIs",
      "BANNED: Exactly-once is very hard (consequences follow)",
      "USE: Database unique constraints help"
    ],
    "(circuit breaker|bulkhead|fallback|graceful degradation)": [
      "FORMAT: Circuit breaker prevents cascade failures",
      "RULE: Bulkhead isolates failures",
      "USE: resilience4j for Java, pybreaker for Python",
      "DO: Define fallback behavior upfront"
    ],
    "(fail fast|resilience|fault tolerance|chaos engineering)": [
      "PRINCIPLE: Fail fast, recover faster",
      "RULE: Design for failure, not just success",
      "USE: Chaos Monkey for fault injection",
      "FORMAT: Health checks and readiness probes"
    ],
    "___ALGORITHMS___": "=== Algorithms, Complexity & DSA ===",
    "(big o|time complexity|space complexity|asymptotic)": [
      "RULE: Big O describes worst case growth",
      "FORMAT: O(1) < O(log n) < O(n) < O(n log n) < O(n\u00b2)",
      "BANNED: Constants matter for small n (consequences follow)",
      "DO: Analyze before optimizing"
    ],
    "(dynamic programming|dp|memoization|tabulation)": [
      "FORMAT: DP = overlapping subproblems + optimal substructure",
      "RULE: Top-down (memo) vs bottom-up (tabulation)",
      "USE: functools.lru_cache for memoization",
      "DO: Define recurrence relation first"
    ],
    "(greedy|backtracking|divide and conquer)": [
      "FORMAT: Greedy makes locally optimal choices",
      "RULE: Greedy doesn't always give global optimum",
      "FORMAT: Backtracking for constraint satisfaction",
      "USE: Draw recursion tree for understanding"
    ],
    "(binary search|two pointers|sliding window)": [
      "FORMAT: Binary search on sorted data",
      "RULE: Two pointers for pair problems",
      "FORMAT: Sliding window for subarray problems",
      "BANNED: Off-by-one errors are common (consequences follow)"
    ],
    "(coding interview|leetcode|hackerrank|competitive)": [
      "FORMAT: Understand problem before coding",
      "RULE: Talk through approach first",
      "USE: Practice on LeetCode/HackerRank",
      "DO: Write test cases before solution"
    ],
    "___MIGRATION_LEGACY___": "=== Migration, Legacy & Interoperability ===",
    "(migrate from|port from|rewrite in|upgrade to)": [
      "BEFORE refactoring >50 lines: /think then /skeptic MANDATORY",
      "BANNED: Refactoring without decomposition plan (spaghetti \u2192 different spaghetti)",
      "COMMIT: Refactor in SEPARATE commit before adding features"
    ],
    "(backwards compatible|breaking change|api version)": [
      "FORMAT: Semantic versioning for APIs",
      "RULE: Breaking changes need migration path",
      "USE: API deprecation warnings",
      "BANNED: Backward compatibility has costs (consequences follow)"
    ],
    "(interop|bridge|wrapper|adapter|legacy)": [
      "FORMAT: Adapter pattern for legacy integration",
      "RULE: Wrap legacy, don't modify it",
      "USE: Write integration tests first",
      "BANNED: Legacy often has undocumented behavior (consequences follow)"
    ],
    "(schema migration|data migration|versioning)": [
      "USE: Alembic for SQLAlchemy migrations",
      "FORMAT: Forward-only migrations in production",
      "RULE: Test migrations on production data copy",
      "BANNED: Large table migrations can lock (consequences follow)"
    ]
  },
  "random_constraints": [
    "Constraint: What if you couldn't use Python? How would you solve this in Bash?",
    "Constraint: What if you had to do this in 1 line? No loops, no functions.",
    "Perspective: How would a security researcher exploit this code?",
    "Perspective: What would break if this ran in production with 1 million users?",
    "Simplification: Can you delete code to solve this problem instead of adding?",
    "Optimization: What if this had to run on a Raspberry Pi with 512MB RAM?",
    "Reliability: What if the network fails halfway through this operation?",
    "Lateral: How would a 1990s developer solve this without modern libraries?",
    "Inversion: Instead of asking 'how to do X', ask 'why do we need X at all?'",
    "Constraint: What if you had to explain this to a non-technical stakeholder?",
    "Adversarial: What's the worst input someone could send to break this?",
    "Scale: What if this had to process 10TB of data?",
    "Time: What if you had to ship this in 30 minutes?",
    "Legacy: What if this had to run on Python 2.7?",
    "Offline: What if there was no internet connection?",
    "Recovery: What happens if this crashes mid-operation?",
    "Audit: Could you explain every line of this code in court?",
    "Minimalism: What's the least code that could work?",
    "Paranoia: What if every external dependency disappears tomorrow?",
    "Accessibility: What if the user is blind or using a screen reader?",
    "Mobile: What if this had to work on a phone with 2G connection?",
    "Debugging: How would you debug this at 3am with only logs?",
    "Documentation: Would your future self understand this in 6 months?",
    "Testing: How would you prove this works without running it?",
    "Rollback: How do you undo this change if it breaks production?",
    "Environment: What if this had to run inside a web browser using WebAssembly?",
    "Serverless: What if this had to run on AWS Lambda with a 15-minute timeout?",
    "Containerization: How would you package this if the final Docker image must be under 50MB?",
    "Air-Gap: How do you deploy and update this on a server with absolutely no internet access?",
    "Energy: What if this is running on a battery-powered device? How do you minimize drain?",
    "OS: What if this needs to run natively on Windows 98?",
    "Dependencies: What if you could only use the Standard Library? No package managers.",
    "Filesystem: What if the disk is read-only?",
    "Concurrency: What if this is running on a single-core CPU?",
    "Streaming: What if the data never stops coming? How do you handle an infinite stream?",
    "Cardinality: What if the input values have high cardinality (e.g., 1 billion unique user IDs)?",
    "Corruption: How does the system behave if 1% of the input data is bit-flipped?",
    "Latency: What if the database query takes 10 seconds to return?",
    "Retention: What if you are legally required to delete this data after 24 hours?",
    "Consistency: What if you are in an eventual consistency environment and the data you just wrote isn't there yet?",
    "Format: What if the input changes from JSON to a proprietary binary format?",
    "Privacy: How do you ensure no PII (Personally Identifiable Information) is ever logged?",
    "Insider: What if the attacker has read-access to your source code repository?",
    "Supply Chain: What if a library you use is hijacked to mine crypto? How would you detect it?",
    "Compliance: How do you implement 'Right to be Forgotten' (GDPR) for this feature?",
    "Cryptography: What if you have to process the data without writing plaintext to RAM?",
    "Auth: What if the authentication token expires mid-request?",
    "Localization: What if the user input is in Arabic (Right-to-Left text)?",
    "Color: How would a colorblind user interpret the success/error state of this?",
    "Input: What if the user is navigating solely via keyboard (no mouse)?",
    "Cost: What if every CPU cycle costs $0.01? How do you make this cheaper?",
    "Bus Factor: If you get hit by a bus, can the junior developer fix this tomorrow?",
    "Functional: What if all variables had to be immutable?",
    "No-Ifs: How would you write this logic without using 'if/else' statements?",
    "Golfing: Can you write the core logic in under 140 characters?",
    "Futurism: How would this algorithm need to change to be quantum-resistant?",
    "Chaos: What if the system clock jumps backward by 1 hour during execution?",
    "API: What if the third-party API you rely on starts rate-limiting you aggressively?"
  ],
  "anti_patterns": {
    "___COMMON_MISTAKES___": "=== Patterns That Trigger Warnings ===",
    "(eval|exec)\\s*\\(": [
      "DANGER: eval/exec are security vulnerabilities",
      "Alternative: Use ast.literal_eval for safe parsing",
      "Action: Refactor to avoid dynamic code execution"
    ],
    "except\\s*:": [
      "WARNING: Bare except catches SystemExit, KeyboardInterrupt",
      "Pattern: except Exception: for general errors",
      "Best: Catch specific exceptions"
    ],
    "TODO|FIXME|HACK|XXX": [
      "WARNING: Incomplete code detected",
      "Action: Resolve TODOs before committing",
      "Tool: void.py detects stub patterns"
    ],
    "print\\s*\\(": [
      "WARNING: Use logging instead of print for production",
      "Pattern: logger.debug() for development output",
      "Action: Remove debug prints before commit"
    ],
    "time\\.sleep": [
      "WARNING: Sleep is usually a code smell",
      "Alternative: Use proper async/await or event-based",
      "Exception: Rate limiting, retry backoff"
    ],
    "\\*\\s+import": [
      "WARNING: Wildcard imports pollute namespace",
      "Pattern: from module import specific_thing",
      "Lesson: Explicit > implicit"
    ],
    "global\\s+": [
      "WARNING: Global variables make code hard to reason about",
      "Alternative: Pass as parameters or use classes",
      "Exception: Module-level constants (UPPER_CASE)"
    ],
    "\\.append\\(.*\\)\\s*$": [
      "CONSIDER: Building list in loop?",
      "Alternative: List comprehension is often cleaner",
      "Pattern: [x for x in items if condition]"
    ]
  },
  "meta": {
    "version": "4.0.0",
    "description": "Synapse Map v4: Assertive directives with explicit negatives and templates",
    "constraint_probability": 0.06,
    "max_associations": 5,
    "max_memories": 3,
    "categories": [
      "browser_automation",
      "database",
      "api_networking",
      "code_quality",
      "debugging",
      "error_types",
      "search_navigation",
      "testing",
      "security",
      "dependencies",
      "git_vcs",
      "memory_context",
      "performance",
      "meta_cognition",
      "research_docs",
      "file_operations",
      "process_system",
      "claude_specific",
      "data_structures",
      "deployment",
      "logging_observability",
      "build_systems",
      "cicd",
      "config_environments",
      "architecture",
      "design_patterns",
      "code_smells",
      "requirements",
      "educational",
      "emotional_cognitive",
      "ml_data_science",
      "web_frontend",
      "web_backend",
      "containers_infra",
      "data_engineering",
      "mobile",
      "game_dev",
      "i18n_l10n",
      "resilience",
      "algorithms",
      "migration_legacy"
    ]
  }
}